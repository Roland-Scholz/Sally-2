ca65 V2.17 - Git 59ab140
Main file   : ..\src\utils\percom.a65
Current file: ..\src\utils\percom.a65

000000r 1               PTR		=	0
000000r 1               DDEVIC		=	$300
000000r 1               DUNIT		=	$301
000000r 1               DCOMND		=	$302
000000r 1               DSTATS		=	$303
000000r 1               DBUFLO		=	$304
000000r 1               DBUFHI		=	$305
000000r 1               DTIMLO		=	$306
000000r 1               DBYTLO		=	$308
000000r 1               DBYTHI		=	$309
000000r 1               DAUX1		=	$30A
000000r 1               DAUX2		=	$30B
000000r 1               
000000r 1               ICCOM		=	$342
000000r 1               ICBLL		=	$348
000000r 1               ICBLH		=	$349
000000r 1               
000000r 1               
000000r 1               CIOV		=	$E456
000000r 1               SIOV		=	$E459
000000r 1               
000000r 1               CPUTB		=	11
000000r 1               EOL		=	$9B
000000r 1               ;
000000r 1               		.org	$2000
002000  1               ;
002000  1  A9 64        START:		lda	#<SALLYMSG
002002  1  85 00        		sta	PTR
002004  1  A9 21        		lda	#>SALLYMSG
002006  1  85 01        		sta	PTR+1
002008  1  20 B1 20     		jsr	PRTSTR
00200B  1               
00200B  1               ;		lda	#<PERTXT0
00200B  1               ;		sta	PTR
00200B  1               ;		lda	#>PERTXT0
00200B  1               ;		sta	PTR+1
00200B  1  20 B1 20     		jsr	PRTSTR
00200E  1               
00200E  1  20 E8 20     		jsr	GETKEY
002011  1  20 C9 20     		jsr	PRINT
002014  1               
002014  1  C9 31        		cmp	#'1'
002016  1  90 0C        		bcc	RETURN
002018  1  C9 39        		cmp	#'8'+1
00201A  1  B0 08        		bcs	RETURN
00201C  1  E9 2F        		sbc	#'1'-2
00201E  1  20 25 20     		jsr	SHOWPER
002021  1  4C 00 20     		jmp	START
002024  1  60           RETURN:		rts
002025  1               
002025  1  8D 01 03     SHOWPER:	sta	DUNIT
002028  1  20 8B 20     		jsr	READPER
00202B  1  98           		tya
00202C  1  30 5C        		bmi	SHOWPEX
00202E  1               
00202E  1  20 B1 20     		jsr	PRTSTR
002031  1  AD 01 03     		lda	DUNIT				;DUNIT
002034  1  A2 00        		ldx	#0
002036  1  20 F1 20     		jsr	PRTWORD
002039  1               
002039  1  20 B1 20     		jsr	PRTSTR				;TRKS
00203C  1  AD 53 21     		lda	PERCOM
00203F  1  20 F1 20     		jsr	PRTWORD
002042  1               
002042  1  20 B1 20     		jsr	PRTSTR				;STEP
002045  1  AD 54 21     		lda	PERCOM+1
002048  1  20 F1 20     		jsr	PRTWORD
00204B  1               
00204B  1  20 B1 20     		jsr	PRTSTR				;SEC/TRK
00204E  1  AD 56 21     		lda	PERCOM+3
002051  1  AE 55 21     		ldx	PERCOM+2
002054  1  20 F1 20     		jsr	PRTWORD
002057  1               
002057  1  20 B1 20     		jsr	PRTSTR				;SIDES
00205A  1  AD 57 21     		lda	PERCOM+4
00205D  1  18           		clc
00205E  1  69 01        		adc	#1
002060  1  20 F1 20     		jsr	PRTWORD
002063  1               
002063  1  20 B1 20     		jsr	PRTSTR				;DESITY
002066  1  AD 58 21     		lda	PERCOM+5
002069  1  20 F1 20     		jsr	PRTWORD
00206C  1               
00206C  1  20 B1 20     		jsr	PRTSTR				;BYT/SEC
00206F  1  AD 5A 21     		lda	PERCOM+7
002072  1  AE 59 21     		ldx	PERCOM+6
002075  1  20 F1 20     		jsr	PRTWORD
002078  1               
002078  1  20 B1 20     		jsr	PRTSTR				;SELECTED
00207B  1  AD 5B 21     		lda	PERCOM+8
00207E  1  20 F1 20     		jsr	PRTWORD
002081  1               
002081  1  20 B1 20     		jsr	PRTSTR				;SERRATE
002084  1  AD 5C 21     		lda	PERCOM+9
002087  1  20 F1 20     		jsr	PRTWORD
00208A  1               
00208A  1  60           SHOWPEX:	rts
00208B  1               
00208B  1               
00208B  1               
00208B  1               
00208B  1               
00208B  1  A9 4E        READPER:	lda	#'N'
00208D  1  8D 02 03     		sta	DCOMND
002090  1  A9 53        		lda	#<PERCOM
002092  1  8D 04 03     		sta	DBUFLO
002095  1  A9 21        		lda	#>PERCOM
002097  1  8D 05 03     		sta	DBUFHI
00209A  1  A9 31        		lda	#'1'
00209C  1  8D 00 03     		sta	DDEVIC
00209F  1  A9 0C        		lda	#<12
0020A1  1  8D 08 03     		sta	DBYTLO
0020A4  1  A9 00        		lda	#>12
0020A6  1  8D 09 03     		sta	DBYTHI
0020A9  1  A9 40        		lda	#$40
0020AB  1  8D 03 03     		sta	DSTATS
0020AE  1  4C 59 E4     		jmp	SIOV
0020B1  1               
0020B1  1  A0 00        PRTSTR:		ldy	#0
0020B3  1  B1 00        		lda	(PTR),Y
0020B5  1  F0 09        		beq	INCPTR
0020B7  1  20 C9 20     		jsr	PRINT
0020BA  1  20 C0 20     		jsr	INCPTR
0020BD  1  4C B1 20     		jmp	PRTSTR
0020C0  1               
0020C0  1  E6 00        INCPTR:		inc	PTR
0020C2  1  D0 02        		bne	INCPTR1
0020C4  1  E6 01        		inc	PTR+1
0020C6  1  60           INCPTR1:	rts
0020C7  1               
0020C7  1               
0020C7  1               ;
0020C7  1  A9 9B        NEWLINE:	lda	#EOL
0020C9  1  48           PRINT:		pha
0020CA  1  8A           		txa
0020CB  1  48           		pha
0020CC  1  98           		tya
0020CD  1  48           		pha
0020CE  1  A2 0B        		ldx	#CPUTB
0020D0  1  8E 42 03     		stx	ICCOM
0020D3  1  BA           		tsx
0020D4  1  BD 03 01     		lda	$103,X
0020D7  1  A2 00        		ldx	#0
0020D9  1  8E 48 03     		stx	ICBLL
0020DC  1  8E 49 03     		stx	ICBLH
0020DF  1  20 56 E4     		jsr	CIOV
0020E2  1  68           		pla
0020E3  1  A8           		tay
0020E4  1  68           		pla
0020E5  1  AA           		tax
0020E6  1  68           		pla
0020E7  1  60           		rts
0020E8  1               
0020E8  1  AD 25 E4     GETKEY:		lda	$E425
0020EB  1  48           		pha
0020EC  1  AD 24 E4     		lda	$E424
0020EF  1  48           		pha
0020F0  1  60           		rts
0020F1  1               ;
0020F1  1  20 27 21     PRTWORD:	jsr	WORD2D
0020F4  1  A2 00        		ldx	#0
0020F6  1  A0 00        		ldy	#0
0020F8  1  B9 61 21     PRTWRD1:	lda	PACKDEC,Y
0020FB  1  4A           		lsr
0020FC  1  4A           		lsr
0020FD  1  4A           		lsr
0020FE  1  4A           		lsr
0020FF  1  20 19 21     		jsr	PRTNIB
002102  1  C0 02        		cpy	#2
002104  1  D0 01        		bne	PRTWRD2
002106  1  E8           		inx
002107  1  B9 61 21     PRTWRD2:	lda	PACKDEC,Y
00210A  1  29 0F        		and	#15
00210C  1  20 19 21     		jsr	PRTNIB
00210F  1  C8           		iny
002110  1  C0 03        		cpy	#3
002112  1  D0 E4        		bne	PRTWRD1
002114  1  A2 00        		ldx	#0
002116  1  4C C7 20     		jmp	NEWLINE
002119  1               
002119  1  D0 05        PRTNIB:		bne	PRTNIB1
00211B  1  E0 00        		cpx	#0
00211D  1  D0 01        		bne	PRTNIB1
00211F  1  60           		rts
002120  1               
002120  1  E8           PRTNIB1:	inx
002121  1  18           		clc
002122  1  69 30        		adc	#'0'
002124  1  4C C9 20     		jmp	PRINT
002127  1               
002127  1               
002127  1  8E 60 21     WORD2D:		stx	WORD+1
00212A  1  8D 5F 21     		sta	WORD
00212D  1               
00212D  1  A2 02        		ldx	#2
00212F  1  A9 00        		lda	#0
002131  1  9D 61 21     WORD2D1:	sta	PACKDEC,X
002134  1  CA           		dex
002135  1  10 FA        		bpl	WORD2D1
002137  1               
002137  1  F8           		sed
002138  1  A2 10        		ldx	#16
00213A  1               
00213A  1  0E 5F 21     WORD2D3:	asl	WORD
00213D  1  2E 60 21     		rol	WORD+1
002140  1               
002140  1  A0 02        		ldy	#2
002142  1  B9 61 21     WORD2D2:	lda	PACKDEC,Y
002145  1  79 61 21     		adc	PACKDEC,Y
002148  1  99 61 21     		sta	PACKDEC,Y
00214B  1  88           		dey
00214C  1  10 F4        		bpl	WORD2D2
00214E  1               
00214E  1  CA           		dex
00214F  1  D0 E9        		bne	WORD2D3
002151  1               
002151  1  D8           		cld
002152  1  60           		rts
002153  1               ;
002153  1               ; VAR + CONST
002153  1               ;
002153  1               
002153  1  00 00 00 00  PERCOM:		.word	0,0,0,0,0,0
002157  1  00 00 00 00  
00215B  1  00 00 00 00  
00215F  1  00 00        WORD:		.word	0
002161  1  00 00 00     PACKDEC:	.byte	0,0,0
002164  1               
002164  1  2A 2A 2A 2A  SALLYMSG:	.byte	"******************", EOL
002168  1  2A 2A 2A 2A  
00216C  1  2A 2A 2A 2A  
002177  1  2A 20 53 61  		.byte	"* Sally 2 tools  *", EOL
00217B  1  6C 6C 79 20  
00217F  1  32 20 74 6F  
00218A  1  2A 2A 2A 2A  		.byte	"******************", EOL
00218E  1  2A 2A 2A 2A  
002192  1  2A 2A 2A 2A  
00219D  1  9B           		.byte	EOL
00219E  1  50 20 2D 20  		.byte	"P - Percom Block Config",EOL
0021A2  1  50 65 72 63  
0021A6  1  6F 6D 20 42  
0021B6  1  56 20 2D 20  		.byte	"V - Show Sally 2 version", EOL
0021BA  1  53 68 6F 77  
0021BE  1  20 53 61 6C  
0021CF  1  00           		.byte	0
0021D0  1               
0021D0  1  9B           PERTXT0:	.byte	EOL
0021D1  1  44 69 73 70  		.byte	"Display PERCOM for"
0021D5  1  6C 61 79 20  
0021D9  1  50 45 52 43  
0021E3  1  20 55 6E 69  		.byte	" Unit (1-8)?"
0021E7  1  74 20 28 31  
0021EB  1  2D 38 29 3F  
0021EF  1  00           		.byte	0
0021F0  1               
0021F0  1  9B           PERTXT1:	.byte	EOL
0021F1  1  2A 2A 2A 2A  		.byte	"****************"
0021F5  1  2A 2A 2A 2A  
0021F9  1  2A 2A 2A 2A  
002201  1  9B           		.byte	EOL
002202  1  2A 20 50 45  		.byte	"* PERCOM BLOCK *"
002206  1  52 43 4F 4D  
00220A  1  20 42 4C 4F  
002212  1  9B           		.byte	EOL
002213  1  2A 2A 2A 2A  		.byte	"****************"
002217  1  2A 2A 2A 2A  
00221B  1  2A 2A 2A 2A  
002223  1  9B           		.byte	EOL
002224  1  55 6E 69 74  		.byte	"Unit   : "
002228  1  20 20 20 3A  
00222C  1  20           
00222D  1  00           		.byte	0
00222E  1               
00222E  1  54 72 61 63  		.byte	"Tracks : "
002232  1  6B 73 20 3A  
002236  1  20           
002237  1  00           		.byte	0
002238  1  53 74 65 70  		.byte	"Step   : "
00223C  1  20 20 20 3A  
002240  1  20           
002241  1  00           		.byte	0
002242  1  53 65 63 2F  		.byte	"Sec/Trk: "
002246  1  54 72 6B 3A  
00224A  1  20           
00224B  1  00           		.byte	0
00224C  1  53 69 64 65  		.byte	"Sides  : "
002250  1  73 20 20 3A  
002254  1  20           
002255  1  00           		.byte	0
002256  1  44 65 6E 73  		.byte	"Density: "
00225A  1  69 74 79 3A  
00225E  1  20           
00225F  1  00           		.byte	0
002260  1  42 79 74 2F  		.byte	"Byt/Sec: "
002264  1  53 65 63 3A  
002268  1  20           
002269  1  00           		.byte	0
00226A  1  53 65 6C 65  		.byte	"Select : "
00226E  1  63 74 20 3A  
002272  1  20           
002273  1  00           		.byte	0
002274  1  53 65 72 52  		.byte	"SerRate: "
002278  1  61 74 65 3A  
00227C  1  20           
00227D  1  00           		.byte	0
00227D  1               
