ca65 V2.17 - Git 59ab140
Main file   : ..\src\utils\percom.a65
Current file: ..\src\utils\percom.a65

000000r 1               PTR		=	0
000000r 1               LFTMARGIN	=	$52
000000r 1               
000000r 1               DVSTAT		=	$2ea
000000r 1               
000000r 1               DDEVIC		=	$300
000000r 1               DUNIT		=	$301
000000r 1               DCOMND		=	$302
000000r 1               DSTATS		=	$303
000000r 1               DBUFLO		=	$304
000000r 1               DBUFHI		=	$305
000000r 1               DTIMLO		=	$306
000000r 1               DBYTLO		=	$308
000000r 1               DBYTHI		=	$309
000000r 1               DAUX1		=	$30A
000000r 1               DAUX2		=	$30B
000000r 1               
000000r 1               ICCOM		=	$342
000000r 1               ICSTA		=	$344
000000r 1               ICBAL		=	$344
000000r 1               ICBAH		=	$345
000000r 1               ICBLL		=	$348
000000r 1               ICBLH		=	$349
000000r 1               ICAX1		=	$34A
000000r 1               ICAX2		=	$34B
000000r 1               
000000r 1               
000000r 1               CIOV		=	$E456
000000r 1               SIOV		=	$E459
000000r 1               
000000r 1               CCOPEN		=	3
000000r 1               CGETB		=	7
000000r 1               CPUTB		=	11
000000r 1               CCLOSE		=	12
000000r 1               
000000r 1               CLS		=	$7D
000000r 1               EOL		=	$9B
000000r 1               ;
000000r 1               		.org	$2000
002000  1               ;
002000  1  A9 00        START:		lda	#0
002002  1  85 52        		sta	LFTMARGIN
002004  1               
002004  1  A9 97        		lda	#<SALLYMSG
002006  1  85 00        		sta	PTR
002008  1  A9 26        		lda	#>SALLYMSG
00200A  1  85 01        		sta	PTR+1
00200C  1  20 CE 24     		jsr	PRTSTR
00200F  1               
00200F  1  A9 C8        		lda	#<MSGDUNIT
002011  1  85 00        		sta	PTR
002013  1  A9 27        		lda	#>MSGDUNIT
002015  1  85 01        		sta	PTR+1
002017  1  20 CE 24     		jsr	PRTSTR
00201A  1               
00201A  1  AD 01 03     		lda	DUNIT				;DUNIT
00201D  1  A2 00        		ldx	#0
00201F  1  20 24 26     		jsr	PRTWORD
002022  1               
002022  1  20 1B 26     		jsr	GETKEY
002025  1  C9 44        		cmp	#'D'
002027  1  F0 23        		beq	DODUMP
002029  1  C9 46        		cmp	#'F'
00202B  1  F0 22        		beq	DOFORMAT
00202D  1  C9 47        		cmp	#'G'
00202F  1  F0 21        		beq	DOGOTO
002031  1  C9 50        		cmp	#'P'
002033  1  F0 2C        		beq	DOPERCOM
002035  1  C9 53        		cmp	#'S'
002037  1  F0 1C        		beq	DOGETSTAT
002039  1  C9 54        		cmp	#'T'
00203B  1  F0 1B        		beq	DOTESTSEC
00203D  1  C9 55        		cmp	#'U'
00203F  1  F0 1A        		beq	DOUPLOAD
002041  1  C9 56        		cmp	#'V'
002043  1  F0 19        		beq	DOVERSION
002045  1  C9 58        		cmp	#'X'
002047  1  F0 02        		beq	EXIT
002049  1  D0 B5        		bne	START
00204B  1  60           EXIT:		rts
00204C  1               
00204C  1  4C E4 24     DODUMP:		jmp	DUMP
00204F  1  4C C9 22     DOFORMAT:	jmp	FORMAT
002052  1  4C 41 22     DOGOTO:		jmp	GOTO
002055  1  4C 0C 23     DOGETSTAT:	jmp	GETSTAT
002058  1  4C 69 22     DOTESTSEC:	jmp	TESTSEC
00205B  1  4C 8C 23     DOUPLOAD:	jmp	UPLOAD
00205E  1  4C 57 23     DOVERSION:	jmp	VERSION
002061  1               
002061  1  A9 70        DOPERCOM:	lda	#<PERTXT0
002063  1  85 00        		sta	PTR
002065  1  A9 27        		lda	#>PERTXT0
002067  1  85 01        		sta	PTR+1
002069  1  20 CE 24     		jsr	PRTSTR
00206C  1               
00206C  1  20 1B 26     		jsr	GETKEY
00206F  1  20 FC 25     		jsr	PRINT
002072  1               
002072  1  C9 31        		cmp	#'1'
002074  1  90 8A        		bcc	START
002076  1  C9 39        		cmp	#'8'+1
002078  1  B0 86        		bcs	START
00207A  1  E9 2F        		sbc	#'1'-2
00207C  1  8D 01 03     		sta	DUNIT
00207F  1  20 89 21     		jsr	READPER				;read percom block
002082  1               ;		tya
002082  1               ;		bmi	DOPERCOM			;iterate if error
002082  1               
002082  1  20 1C 21     DOPERCOM1:	jsr	SHOWPER				;display percom block
002085  1               
002085  1  20 1B 26     		jsr	GETKEY
002088  1  C9 54        		cmp	#'T'
00208A  1  F0 20        		beq	TRACKS
00208C  1  C9 53        		cmp	#'S'
00208E  1  F0 30        		beq	SECS
002090  1  C9 48        		cmp	#'H'
002092  1  F0 46        		beq	HEADS
002094  1  C9 44        		cmp	#'D'
002096  1  F0 56        		beq	DENSITY
002098  1  C9 42        		cmp	#'B'
00209A  1  F0 66        		beq	BYTES
00209C  1  C9 57        		cmp	#'W'
00209E  1  F0 06        		beq	WRITEPERC
0020A0  1  C9 58        		cmp	#'X'
0020A2  1  F0 BD        		beq	DOPERCOM
0020A4  1  D0 DC        		bne	DOPERCOM1
0020A6  1               
0020A6  1               ;
0020A6  1               ;
0020A6  1               ;
0020A6  1  20 80 21     WRITEPERC:	jsr	WRITEPER
0020A9  1  4C 82 20     		jmp	DOPERCOM1
0020AC  1               
0020AC  1  A9 D6        TRACKS:		lda	#<MSGTRK
0020AE  1  85 00        		sta	PTR
0020B0  1  A9 27        		lda	#>MSGTRK
0020B2  1  85 01        		sta	PTR+1
0020B4  1  20 CE 24     		jsr	PRTSTR
0020B7  1  20 7F 25     		jsr	getbyte
0020BA  1  8D 86 26     		sta	PERTRK
0020BD  1  4C 82 20     		jmp	DOPERCOM1
0020C0  1               
0020C0  1  A9 F2        SECS:		lda	#<MSGSEC
0020C2  1  85 00        		sta	PTR
0020C4  1  A9 27        		lda	#>MSGSEC
0020C6  1  85 01        		sta	PTR+1
0020C8  1  20 CE 24     		jsr	PRTSTR
0020CB  1  20 7F 25     		jsr	getbyte
0020CE  1  8D 89 26     		sta	PERSEC+1
0020D1  1  AD 93 26     		lda	WORD+1
0020D4  1  8D 88 26     		sta	PERSEC
0020D7  1  4C 82 20     		jmp	DOPERCOM1
0020DA  1               
0020DA  1  A9 00        HEADS:		lda	#<MSGHEA
0020DC  1  85 00        		sta	PTR
0020DE  1  A9 28        		lda	#>MSGHEA
0020E0  1  85 01        		sta	PTR+1
0020E2  1  20 CE 24     		jsr	PRTSTR
0020E5  1  20 7F 25     		jsr	getbyte
0020E8  1  8D 8A 26     		sta	PERHEA
0020EB  1  4C 82 20     		jmp	DOPERCOM1
0020EE  1  A9 0E        DENSITY:	lda	#<MSGDEN
0020F0  1  85 00        		sta	PTR
0020F2  1  A9 28        		lda	#>MSGDEN
0020F4  1  85 01        		sta	PTR+1
0020F6  1  20 CE 24     		jsr	PRTSTR
0020F9  1  20 7F 25     		jsr	getbyte
0020FC  1  8D 8B 26     		sta	PERDEN
0020FF  1  4C 82 20     		jmp	DOPERCOM1
002102  1  A9 1C        BYTES:		lda	#<MSGBYT
002104  1  85 00        		sta	PTR
002106  1  A9 28        		lda	#>MSGBYT
002108  1  85 01        		sta	PTR+1
00210A  1  20 CE 24     		jsr	PRTSTR
00210D  1  20 7F 25     		jsr	getbyte
002110  1  8D 8D 26     		sta	PERBYT+1
002113  1  AD 93 26     		lda	WORD+1
002116  1  8D 8C 26     		sta	PERBYT
002119  1  4C 82 20     		jmp	DOPERCOM1
00211C  1               ;
00211C  1               ;
00211C  1               ;
00211C  1  A9 94        SHOWPER:	lda	#<PERTXT1
00211E  1  85 00        		sta	PTR
002120  1  A9 27        		lda	#>PERTXT1
002122  1  85 01        		sta	PTR+1
002124  1  20 CE 24     		jsr	PRTSTR
002127  1               
002127  1  AD 01 03     		lda	DUNIT				;DUNIT
00212A  1  A2 00        		ldx	#0
00212C  1  20 24 26     		jsr	PRTWORD
00212F  1               
00212F  1  20 CE 24     		jsr	PRTSTR				;TRKS
002132  1  AD 86 26     		lda	PERCOM
002135  1  20 24 26     		jsr	PRTWORD
002138  1               
002138  1  20 CE 24     		jsr	PRTSTR				;STEP
00213B  1  AD 87 26     		lda	PERCOM+1
00213E  1  20 24 26     		jsr	PRTWORD
002141  1               
002141  1  20 CE 24     		jsr	PRTSTR				;SEC/TRK
002144  1  AD 89 26     		lda	PERCOM+3
002147  1  AE 88 26     		ldx	PERCOM+2
00214A  1  20 24 26     		jsr	PRTWORD
00214D  1               
00214D  1  20 CE 24     		jsr	PRTSTR				;SIDES
002150  1  AD 8A 26     		lda	PERCOM+4
002153  1               ;		clc
002153  1               ;		adc	#1
002153  1  20 24 26     		jsr	PRTWORD
002156  1               
002156  1  20 CE 24     		jsr	PRTSTR				;DESITY
002159  1  AD 8B 26     		lda	PERCOM+5
00215C  1  20 24 26     		jsr	PRTWORD
00215F  1               
00215F  1  20 CE 24     		jsr	PRTSTR				;BYT/SEC
002162  1  AD 8D 26     		lda	PERCOM+7
002165  1  AE 8C 26     		ldx	PERCOM+6
002168  1  20 24 26     		jsr	PRTWORD
00216B  1               
00216B  1  20 CE 24     		jsr	PRTSTR				;SELECTED
00216E  1  AD 8E 26     		lda	PERCOM+8
002171  1  20 24 26     		jsr	PRTWORD
002174  1               
002174  1  20 CE 24     		jsr	PRTSTR				;SERRATE
002177  1  AD 8F 26     		lda	PERCOM+9
00217A  1  20 24 26     		jsr	PRTWORD
00217D  1               
00217D  1  4C CE 24     		jmp	PRTSTR
002180  1               
002180  1               
002180  1  A9 80        WRITEPER:	lda	#$80
002182  1  8D 03 03     		sta	DSTATS
002185  1  A9 4F        		lda	#'O'
002187  1  D0 07        		bne	READPER1
002189  1  A9 40        READPER:	lda	#$40
00218B  1  8D 03 03     		sta	DSTATS
00218E  1  A9 4E        		lda	#'N'
002190  1  8D 02 03     READPER1:	sta	DCOMND
002193  1  A9 86        		lda	#<PERCOM
002195  1  8D 04 03     		sta	DBUFLO
002198  1  A9 26        		lda	#>PERCOM
00219A  1  8D 05 03     		sta	DBUFHI
00219D  1  A9 31        		lda	#'1'
00219F  1  8D 00 03     		sta	DDEVIC
0021A2  1  A9 0C        		lda	#<12
0021A4  1  8D 08 03     		sta	DBYTLO
0021A7  1  A9 00        		lda	#>12
0021A9  1  8D 09 03     		sta	DBYTHI
0021AC  1  4C 48 23     		jmp	CALLSIO
0021AF  1               
0021AF  1  A9 00        SETADR:		lda	#0
0021B1  1  8D 03 03     		sta	DSTATS
0021B4  1  A9 53        		lda	#'S'
0021B6  1  8D 02 03     		sta	DCOMND
0021B9  1  A9 5A        		lda	#'Z'
0021BB  1  8D 00 03     		sta	DDEVIC
0021BE  1  A9 01        		lda	#1
0021C0  1  8D 01 03     		sta	DUNIT
0021C3  1  A9 00        		lda	#0
0021C5  1  8D 08 03     		sta	DBYTLO
0021C8  1  8D 09 03     		sta	DBYTHI
0021CB  1  AD 8B 28     		lda	SALLYADR
0021CE  1  8D 0A 03     		sta	DAUX1
0021D1  1  AD 8C 28     		lda	SALLYADR+1
0021D4  1  8D 0B 03     		sta	DAUX2
0021D7  1  4C 59 E4     		jmp	SIOV
0021DA  1               
0021DA  1  20 AF 21     PUTRAM:		jsr	SETADR
0021DD  1  A9 57        		lda	#'W'
0021DF  1  8D 02 03     		sta	DCOMND
0021E2  1  A9 80        		lda	#128
0021E4  1  8D 03 03     		sta	DSTATS
0021E7  1  D0 0D        		bne	GETRAM1
0021E9  1               
0021E9  1  20 AF 21     GETRAM:		jsr	SETADR
0021EC  1  A9 52        		lda	#'R'
0021EE  1  8D 02 03     		sta	DCOMND
0021F1  1  A9 40        		lda	#64
0021F3  1  8D 03 03     		sta	DSTATS
0021F6  1  A9 92        GETRAM1:	lda	#<BUFFER
0021F8  1  8D 04 03     		sta	DBUFLO
0021FB  1  A9 28        		lda	#>BUFFER
0021FD  1  8D 05 03     		sta	DBUFHI
002200  1  A9 00        		lda	#0
002202  1  8D 0A 03     		sta	DAUX1
002205  1  8D 08 03     		sta	DBYTLO
002208  1  A9 01        		lda	#1
00220A  1  8D 0B 03     		sta	DAUX2
00220D  1  8D 09 03     		sta	DBYTHI
002210  1  4C 59 E4     		jmp	SIOV
002213  1               
002213  1  20 AF 21     GOTOADR:	jsr	SETADR
002216  1  A9 5A        		lda	#'Z'
002218  1  8D 00 03     		sta	DDEVIC
00221B  1  A9 01        		lda	#1
00221D  1  8D 01 03     		sta	DUNIT
002220  1  A9 47        		lda	#'G'
002222  1  8D 02 03     		sta	DCOMND
002225  1  A9 00        		lda	#0
002227  1  8D 03 03     		sta	DSTATS
00222A  1  AD 8B 28     		lda	SALLYADR
00222D  1  8D 0A 03     		sta	DAUX1
002230  1  AD 8C 28     		lda	SALLYADR+1
002233  1  8D 0B 03     		sta	DAUX2
002236  1  A9 00        		lda	#0
002238  1  8D 08 03     		sta	DBYTLO
00223B  1  8D 09 03     		sta	DBYTHI
00223E  1  4C 59 E4     		jmp	SIOV
002241  1               ;
002241  1               ;
002241  1               ;
002241  1  20 1B 25     GOTO:		jsr	getadr
002244  1  C9 58        		cmp	#'X'
002246  1  F0 1E        		beq	GOTOEND
002248  1  AD 92 26     		lda	WORD
00224B  1  8D 8B 28     		sta	SALLYADR
00224E  1  AD 93 26     		lda	WORD+1
002251  1  8D 8C 28     		sta	SALLYADR+1
002254  1  20 13 22     		jsr	GOTOADR
002257  1  AD 8C 28     		lda	SALLYADR+1
00225A  1  20 DA 25     		jsr	puthex
00225D  1  AD 8B 28     		lda	SALLYADR
002260  1  20 DA 25     		jsr	puthex
002263  1  20 1B 26     		jsr	GETKEY
002266  1  4C 00 20     GOTOEND:	jmp	START
002269  1               ;
002269  1               ;
002269  1               ;
002269  1  A9 31        TESTSEC:	lda	#'1'
00226B  1  8D 00 03     		sta	DDEVIC
00226E  1  A9 52        		lda	#'R'
002270  1  8D 02 03     		sta	DCOMND
002273  1  A9 92        		lda	#<BUFFER
002275  1  8D 04 03     		sta	DBUFLO
002278  1  A9 28        		lda	#>BUFFER
00227A  1  8D 05 03     		sta	DBUFHI
00227D  1  A9 01        		lda	#1
00227F  1  8D 0A 03     		sta	DAUX1
002282  1  A9 00        		lda	#0
002284  1  8D 0B 03     		sta	DAUX2
002287  1  A9 40        TESTSEC1:	lda	#64
002289  1  8D 03 03     		sta	DSTATS
00228C  1  A9 80        		lda	#128
00228E  1  8D 08 03     		sta	DBYTLO
002291  1  A9 00        		lda	#0
002293  1  8D 09 03     		sta	DBYTHI
002296  1  AD 0B 03     		lda	DAUX2
002299  1  D0 07        		bne	TESTSEC2
00229B  1  AD 0A 03     		lda	DAUX1
00229E  1  C9 04        		cmp	#4
0022A0  1  90 06        		bcc	TESTSEC4
0022A2  1  0E 08 03     TESTSEC2:	asl	DBYTLO
0022A5  1  2E 09 03     		rol	DBYTHI
0022A8  1  AD 0B 03     TESTSEC4:	lda	DAUX2
0022AB  1  20 DA 25     		jsr	puthex
0022AE  1  AD 0A 03     		lda	DAUX1
0022B1  1  20 DA 25     		jsr	puthex
0022B4  1  20 FA 25     		jsr	NEWLINE
0022B7  1  20 48 23     		jsr	CALLSIO
0022BA  1  30 0A        		bmi	TESTSEC3
0022BC  1  EE 0A 03     		inc	DAUX1
0022BF  1  D0 C6        		bne	TESTSEC1
0022C1  1  EE 0B 03     		inc	DAUX2
0022C4  1  D0 C1        		bne	TESTSEC1
0022C6  1  4C 00 20     TESTSEC3:	jmp	START
0022C9  1               
0022C9  1               ;
0022C9  1               ;
0022C9  1               ;
0022C9  1  A9 31        FORMAT:		lda	#'1'
0022CB  1  8D 00 03     		sta	DDEVIC
0022CE  1  A9 21        		lda	#'!'
0022D0  1  8D 02 03     		sta	DCOMND
0022D3  1  A9 40        		lda	#64
0022D5  1  8D 03 03     		sta	DSTATS
0022D8  1  A9 92        		lda	#<BUFFER
0022DA  1  8D 04 03     		sta	DBUFLO
0022DD  1  A9 28        		lda	#>BUFFER
0022DF  1  8D 05 03     		sta	DBUFHI
0022E2  1  AD 06 03     		lda	DTIMLO
0022E5  1  48           		pha
0022E6  1  A9 FF        		lda	#$ff
0022E8  1  8D 06 03     		sta	DTIMLO
0022EB  1  A9 80        		lda	#128
0022ED  1  8D 08 03     		sta	DBYTLO
0022F0  1  A9 00        		lda	#0
0022F2  1  8D 09 03     		sta	DBYTHI
0022F5  1  AD 8B 26     		lda	PERDEN
0022F8  1  29 04        		and	#4
0022FA  1  F0 06        		beq	FORMAT1
0022FC  1  0E 08 03     		asl	DBYTLO
0022FF  1  2E 09 03     		rol	DBYTHI
002302  1  20 48 23     FORMAT1:	jsr	CALLSIO
002305  1  68           		pla
002306  1  8D 06 03     		sta	DTIMLO
002309  1  4C 00 20     		jmp	START
00230C  1               
00230C  1  A9 31        GETSTAT:	lda	#'1'
00230E  1  8D 00 03     		sta	DDEVIC
002311  1  A9 53        		lda	#'S'
002313  1  8D 02 03     		sta	DCOMND
002316  1  A9 40        		lda	#64
002318  1  8D 03 03     		sta	DSTATS
00231B  1  A9 EA        		lda	#<DVSTAT
00231D  1  8D 04 03     		sta	DBUFLO
002320  1  A9 02        		lda	#>DVSTAT
002322  1  8D 05 03     		sta	DBUFHI
002325  1  A9 04        		lda	#4
002327  1  8D 08 03     		sta	DBYTLO
00232A  1  A9 00        		lda	#0
00232C  1  8D 09 03     		sta	DBYTHI
00232F  1  20 48 23     		jsr	CALLSIO
002332  1               
002332  1  A2 00        		ldx	#0
002334  1  BD EA 02     GETSTAT1:	lda	DVSTAT,x
002337  1  20 DA 25     		jsr	puthex
00233A  1  20 F6 25     		jsr	SPACE
00233D  1  E8           		inx
00233E  1  E0 04        		cpx	#4
002340  1  D0 F2        		bne	GETSTAT1
002342  1  20 1B 26     		jsr	GETKEY
002345  1  4C 00 20     		jmp	START
002348  1               
002348  1  20 59 E4     CALLSIO:	jsr	SIOV
00234B  1  10 09        		bpl	CALLSIO1
00234D  1  98           		tya
00234E  1  20 DA 25     		jsr	puthex
002351  1  20 F6 25     		jsr	SPACE
002354  1  A0 80        		ldy	#128
002356  1  60           CALLSIO1:	rts
002357  1               
002357  1  A9 00        VERSION:	lda	#0
002359  1  8D 8B 28     		sta	SALLYADR
00235C  1  8D 8C 28     		sta	SALLYADR+1
00235F  1  20 E9 21     		jsr	GETRAM
002362  1               
002362  1  38           		sec
002363  1  AD C1 28     		lda	BUFFER+$2f
002366  1  E9 1F        		sbc	#$1f
002368  1  8D 8B 28     		sta	SALLYADR
00236B  1  AD C2 28     		lda	BUFFER+$30
00236E  1  E9 00        		sbc	#0
002370  1  8D 8C 28     		sta	SALLYADR+1
002373  1  20 E9 21     		jsr	GETRAM
002376  1               
002376  1  A2 00        		ldx	#0
002378  1  BD 92 28     VERSION1:	lda	BUFFER,x
00237B  1  20 FC 25     		jsr	PRINT
00237E  1  E8           		inx
00237F  1  E0 10        		cpx	#16
002381  1  D0 F5        		bne	VERSION1
002383  1  20 FA 25     		jsr	NEWLINE
002386  1  20 1B 26     		jsr	GETKEY
002389  1  4C 00 20     		jmp	START
00238C  1               
00238C  1               ;
00238C  1               ; uploads sally2.com to $2000 using a 256 buffer @ BUFFER
00238C  1               ;
00238C  1  20 FD 23     UPLOAD:		jsr	openfile
00238F  1               
00238F  1  A9 00        		lda	#0
002391  1  8D 8B 28     		sta	SALLYADR
002394  1  A9 20        		lda	#$20
002396  1  8D 8C 28     		sta	SALLYADR+1
002399  1               
002399  1  20 25 24     upload1:	jsr	readfile			;read a page from file
00239C  1  BD 49 03     		lda	ICBLH,x
00239F  1  20 DA 25     		jsr	puthex
0023A2  1  BD 48 03     		lda	ICBLL,x
0023A5  1  20 DA 25     		jsr	puthex
0023A8  1  20 F6 25     		jsr	SPACE
0023AB  1               
0023AB  1  20 DA 21     		jsr	PUTRAM				;put to Sally RAM
0023AE  1  98           		tya
0023AF  1  20 DA 25     		jsr	puthex
0023B2  1  A8           		tay
0023B3  1  30 45        		bmi	uploadex
0023B5  1               
0023B5  1  20 F6 25     		jsr	SPACE
0023B8  1               
0023B8  1  AD 8C 28     		lda	SALLYADR+1
0023BB  1  20 DA 25     		jsr	puthex
0023BE  1  AD 8B 28     		lda	SALLYADR
0023C1  1  20 DA 25     		jsr	puthex
0023C4  1               
0023C4  1  20 FA 25     		jsr	NEWLINE
0023C7  1               
0023C7  1  EE 8C 28     		inc	SALLYADR+1
0023CA  1  A2 10        		ldx	#$10
0023CC  1  BD 49 03     		lda	ICBLH,x				;check if 256 were loaded
0023CF  1  D0 C8        		bne	upload1				;loop if yes
0023D1  1               
0023D1  1  20 4D 24     		jsr	closefile
0023D4  1               
0023D4  1  A9 00        		lda	#0
0023D6  1  8D 8B 28     		sta	SALLYADR
0023D9  1  A9 20        		lda	#$20
0023DB  1  8D 8C 28     		sta	SALLYADR+1
0023DE  1  20 E9 21     		jsr	GETRAM
0023E1  1               
0023E1  1  38           		sec
0023E2  1  AD C1 28     		lda	BUFFER+$2f
0023E5  1  E9 0F        		sbc	#$0f
0023E7  1  8D 8B 28     		sta	SALLYADR
0023EA  1  AD C2 28     		lda	BUFFER+$30
0023ED  1  E9 00        		sbc	#0
0023EF  1  69 1F        		adc	#$20-1
0023F1  1  8D 8C 28     		sta	SALLYADR+1
0023F4  1               
0023F4  1  20 1B 26     		jsr	GETKEY
0023F7  1  20 13 22     		jsr	GOTOADR
0023FA  1               
0023FA  1  4C 00 20     uploadex:	jmp	START
0023FD  1               
0023FD  1               ;
0023FD  1               ;
0023FD  1               ;
0023FD  1  A2 10        openfile:	ldx	#$10
0023FF  1  A9 03        		lda	#CCOPEN
002401  1  9D 42 03     		sta	ICCOM,x
002404  1  A9 73        		lda	#<sallycom
002406  1  9D 44 03     		sta	ICBAL,x
002409  1  A9 28        		lda	#>sallycom
00240B  1  9D 45 03     		sta	ICBAH,x
00240E  1  A9 00        		lda	#0
002410  1  9D 48 03     		sta	ICBLL,x
002413  1  A9 01        		lda	#1
002415  1  9D 49 03     		sta	ICBLH,x
002418  1  A9 04        		lda	#4
00241A  1  9D 4A 03     		sta	ICAX1,x
00241D  1  A9 00        		lda	#0
00241F  1  9D 4B 03     		sta	ICAX2,x
002422  1  4C 56 E4     		jmp	CIOV
002425  1               
002425  1  A2 10        readfile:	ldx	#$10
002427  1  A9 07        		lda	#CGETB
002429  1  9D 42 03     		sta	ICCOM,x
00242C  1  A9 92        		lda	#<BUFFER
00242E  1  9D 44 03     		sta	ICBAL,x
002431  1  A9 28        		lda	#>BUFFER
002433  1  9D 45 03     		sta	ICBAH,x
002436  1  A9 00        		lda	#$00
002438  1  9D 48 03     		sta	ICBLL,x
00243B  1  A9 01        		lda	#$01
00243D  1  9D 49 03     		sta	ICBLH,x
002440  1  A9 04        		lda	#4
002442  1  9D 4A 03     		sta	ICAX1,x
002445  1  A9 00        		lda	#0
002447  1  9D 4B 03     		sta	ICAX2,x
00244A  1  4C 56 E4     		jmp	CIOV
00244D  1               
00244D  1  A2 10        closefile:	ldx	#$10
00244F  1  A9 0C        		lda	#CCLOSE
002451  1  9D 42 03     		sta	ICCOM,x
002454  1  4C 56 E4     		jmp	CIOV
002457  1               
002457  1               ;
002457  1               ;
002457  1               ;
002457  1  A2 00        dumpbuf:	ldx	#0
002459  1  A0 08        		ldy	#8
00245B  1  A9 10        		lda	#16
00245D  1  8D 92 26     		sta	WORD
002460  1               
002460  1  AD 8B 28     		lda	SALLYADR
002463  1  8D 8F 28     		sta	DUMPADR
002466  1  AD 8C 28     		lda	SALLYADR+1
002469  1  8D 90 28     		sta	DUMPADR+1
00246C  1               
00246C  1  20 AE 24     dumpbuf2:	jsr	dumpadr
00246F  1  BD 92 28     dumpbuf1:	lda	BUFFER,x
002472  1  20 DA 25     		jsr	puthex
002475  1  E8           		inx
002476  1  20 F6 25     		jsr	SPACE
002479  1  88           dumpbuf3:	dey
00247A  1  D0 F3        		bne	dumpbuf1
00247C  1               
00247C  1  8A           		txa
00247D  1  38           		sec
00247E  1  E9 08        		sbc	#8
002480  1  AA           		tax
002481  1               
002481  1  A0 08        		ldy	#8
002483  1  A9 7C        		lda	#'|'
002485  1  20 FC 25     		jsr	PRINT
002488  1               
002488  1  BD 92 28     dumpbuf5:	lda	BUFFER,x
00248B  1  29 7F        		and	#$7f
00248D  1  C9 20        		cmp	#32
00248F  1  90 04        		bcc	dumpbuf4
002491  1  C9 7D        		cmp	#$7d
002493  1  90 02        		bcc	dumpbuf6
002495  1  A9 2E        dumpbuf4:	lda	#'.'
002497  1  20 FC 25     dumpbuf6:	jsr	PRINT
00249A  1  E8           		inx
00249B  1  88           		dey
00249C  1  D0 EA        		bne	dumpbuf5
00249E  1               
00249E  1  A9 7C        		lda	#'|'
0024A0  1  20 FC 25     		jsr	PRINT
0024A3  1  20 FA 25     		jsr	NEWLINE
0024A6  1               
0024A6  1  A0 08        		ldy	#8
0024A8  1  CE 92 26     		dec	WORD
0024AB  1  D0 BF        		bne	dumpbuf2
0024AD  1  60           		rts
0024AE  1               
0024AE  1  AD 90 28     dumpadr:	lda	DUMPADR+1
0024B1  1  20 DA 25     		jsr	puthex
0024B4  1  AD 8F 28     		lda	DUMPADR
0024B7  1  20 DA 25     		jsr	puthex
0024BA  1  A9 3A        		lda	#':'
0024BC  1  20 FC 25     		jsr	PRINT
0024BF  1  18           		clc
0024C0  1  AD 8F 28     		lda	DUMPADR
0024C3  1  69 08        		adc	#8
0024C5  1  8D 8F 28     		sta	DUMPADR
0024C8  1  90 03        		bcc	dumpadr1
0024CA  1  EE 90 28     		inc	DUMPADR+1
0024CD  1  60           dumpadr1:	rts
0024CE  1               
0024CE  1  A0 00        PRTSTR:		ldy	#0
0024D0  1  B1 00        		lda	(PTR),Y
0024D2  1  F0 09        		beq	INCPTR
0024D4  1  20 FC 25     		jsr	PRINT
0024D7  1  20 DD 24     		jsr	INCPTR
0024DA  1  4C CE 24     		jmp	PRTSTR
0024DD  1               
0024DD  1  E6 00        INCPTR:		inc	PTR
0024DF  1  D0 02        		bne	INCPTR1
0024E1  1  E6 01        		inc	PTR+1
0024E3  1  60           INCPTR1:	rts
0024E4  1               
0024E4  1               ;
0024E4  1               ;
0024E4  1               ;
0024E4  1  20 1B 25     DUMP:		jsr	getadr
0024E7  1  C9 58        		cmp	#'X'
0024E9  1  D0 03        		bne	DUMP1
0024EB  1  4C 00 20     		jmp	START
0024EE  1  C9 9B        DUMP1:		cmp	#EOL
0024F0  1  D0 11        		bne	DUMP2
0024F2  1  18           		clc
0024F3  1  AD 8B 28     		lda	SALLYADR
0024F6  1  69 80        		adc	#128
0024F8  1  8D 8B 28     		sta	SALLYADR
0024FB  1  90 03        		bcc	DUMP4
0024FD  1  EE 8C 28     		inc	SALLYADR+1
002500  1  4C 0F 25     DUMP4:		jmp	DUMP3
002503  1               
002503  1  AD 92 26     DUMP2:		lda	WORD
002506  1  8D 8B 28     		sta	SALLYADR
002509  1  AD 93 26     		lda	WORD+1
00250C  1  8D 8C 28     		sta	SALLYADR+1
00250F  1  20 FA 25     DUMP3:		jsr	NEWLINE
002512  1  20 E9 21     		jsr	GETRAM
002515  1  20 57 24     		jsr	dumpbuf
002518  1  4C E4 24     		jmp	DUMP
00251B  1               
00251B  1  A9 80        getadr:		lda	#<msgadr
00251D  1  85 00        		sta	PTR
00251F  1  A9 28        		lda	#>msgadr
002521  1  85 01        		sta	PTR+1
002523  1  20 CE 24     		jsr	PRTSTR
002526  1               
002526  1  A9 00        		lda	#0
002528  1  8D 92 26     		sta	WORD
00252B  1  8D 93 26     		sta	WORD+1
00252E  1  A9 04        		lda	#4
002530  1  8D 91 28     		sta	CNT
002533  1               
002533  1  20 56 25     getadr2:	jsr	getnibble
002536  1  C9 10        		cmp	#16
002538  1  B0 1B        		bcs	getadr3
00253A  1  A2 03        		ldx	#3
00253C  1  0E 92 26     getadr4:	asl	WORD
00253F  1  2E 93 26     		rol	WORD+1
002542  1  CA           		dex
002543  1  10 F7        		bpl	getadr4
002545  1  6D 92 26     		adc	WORD
002548  1  8D 92 26     		sta	WORD
00254B  1  90 03        		bcc	getadr1
00254D  1  EE 93 26     		inc	WORD+1
002550  1  CE 91 28     getadr1:	dec	CNT
002553  1  D0 DE        		bne	getadr2
002555  1  60           getadr3:	rts
002556  1               
002556  1  20 1B 26     getnibble:	jsr	GETKEY
002559  1  C9 9B        		cmp	#EOL
00255B  1  F0 21        		beq	getnibex
00255D  1  C9 58        		cmp	#'X'
00255F  1  F0 1D        		beq	getnibex
002561  1  C9 30        		cmp	#'0'
002563  1  90 F1        		bcc	getnibble
002565  1  C9 3A        		cmp	#'9'+1
002567  1  90 0F        		bcc	getnib09
002569  1               
002569  1  C9 41        		cmp	#'A'
00256B  1  90 E9        		bcc	getnibble
00256D  1  C9 47        		cmp	#'F'+1
00256F  1  B0 E5        		bcs	getnibble
002571  1  20 FC 25     		jsr	PRINT
002574  1  38           		sec
002575  1  E9 37        		sbc	#'A'-10
002577  1  60           		rts
002578  1  20 FC 25     getnib09:	jsr	PRINT
00257B  1  38           		sec
00257C  1  E9 30        		sbc	#'0'
00257E  1  60           getnibex:	rts
00257F  1               
00257F  1               ;
00257F  1               ; reads a byte value given in decimal
00257F  1               ;
00257F  1  A2 03        getbyte:	ldx	#3
002581  1  8E 94 26     		stx	PACKDEC
002584  1  A9 00        		lda	#0
002586  1  8D 92 26     		sta	WORD
002589  1  8D 93 26     		sta	WORD+1
00258C  1  20 C3 25     getbyte1:	jsr	getnum
00258F  1  30 2E        		bmi	getbyteex
002591  1  AD 92 26     		lda	WORD
002594  1  0A           		asl
002595  1  2E 93 26     		rol	WORD+1
002598  1  0A           		asl
002599  1  2E 93 26     		rol	WORD+1
00259C  1  6D 92 26     		adc	WORD
00259F  1  8D 92 26     		sta	WORD
0025A2  1  90 03        		bcc	getbyte2
0025A4  1  EE 93 26     		inc	WORD+1
0025A7  1  0A           getbyte2:	asl
0025A8  1  8D 92 26     		sta	WORD
0025AB  1  2E 93 26     		rol	WORD+1
0025AE  1  98           		tya
0025AF  1  6D 92 26     		adc	WORD
0025B2  1  8D 92 26     		sta	WORD
0025B5  1  90 03        		bcc	getbyte3
0025B7  1  EE 93 26     		inc	WORD+1
0025BA  1  CE 94 26     getbyte3:	dec	PACKDEC
0025BD  1  D0 CD        		bne	getbyte1
0025BF  1  AD 92 26     getbyteex:	lda	WORD
0025C2  1  60           		rts
0025C3  1               
0025C3  1  20 1B 26     getnum:		jsr	GETKEY
0025C6  1  C9 9B        		cmp	#EOL
0025C8  1  F0 0E        		beq	getnumex
0025CA  1  C9 30        		cmp	#'0'
0025CC  1  90 F5        		bcc	getnum
0025CE  1  C9 3A        		cmp	#'9'+1
0025D0  1  B0 F1        		bcs	getnum
0025D2  1  20 FC 25     		jsr	PRINT
0025D5  1  38           		sec
0025D6  1  E9 30        		sbc	#'0'
0025D8  1  A8           getnumex:	tay
0025D9  1  60           		rts
0025DA  1               
0025DA  1               ;
0025DA  1  48           puthex:		pha
0025DB  1  48           		pha
0025DC  1  4A           		lsr
0025DD  1  4A           		lsr
0025DE  1  4A           		lsr
0025DF  1  4A           		lsr
0025E0  1  20 EB 25     		jsr	putnib
0025E3  1  68           		pla
0025E4  1  29 0F        		and	#$0f
0025E6  1  20 EB 25     		jsr	putnib
0025E9  1  68           		pla
0025EA  1  60           		rts
0025EB  1               
0025EB  1  C9 0A        putnib:		cmp	#10
0025ED  1  90 02        		bcc	putnib1
0025EF  1  69 06        		adc	#6
0025F1  1  69 30        putnib1:	adc	#'0'
0025F3  1  4C FC 25     		jmp	PRINT
0025F6  1               
0025F6  1  A9 20        SPACE:		lda	#32
0025F8  1  D0 02        		bne	PRINT
0025FA  1  A9 9B        NEWLINE:	lda	#EOL
0025FC  1  48           PRINT:		pha
0025FD  1  8A           		txa
0025FE  1  48           		pha
0025FF  1  98           		tya
002600  1  48           		pha
002601  1  A2 0B        		ldx	#CPUTB
002603  1  8E 42 03     		stx	ICCOM
002606  1  BA           		tsx
002607  1  BD 03 01     		lda	$103,X
00260A  1  A2 00        		ldx	#0
00260C  1  8E 48 03     		stx	ICBLL
00260F  1  8E 49 03     		stx	ICBLH
002612  1  20 56 E4     		jsr	CIOV
002615  1  68           		pla
002616  1  A8           		tay
002617  1  68           		pla
002618  1  AA           		tax
002619  1  68           		pla
00261A  1  60           		rts
00261B  1               
00261B  1  AD 25 E4     GETKEY:		lda	$E425
00261E  1  48           		pha
00261F  1  AD 24 E4     		lda	$E424
002622  1  48           		pha
002623  1  60           		rts
002624  1               ;
002624  1  20 5A 26     PRTWORD:	jsr	WORD2D
002627  1  A2 00        		ldx	#0
002629  1  A0 00        		ldy	#0
00262B  1  B9 94 26     PRTWRD1:	lda	PACKDEC,Y
00262E  1  4A           		lsr
00262F  1  4A           		lsr
002630  1  4A           		lsr
002631  1  4A           		lsr
002632  1  20 4C 26     		jsr	PRTNIB
002635  1  C0 02        		cpy	#2
002637  1  D0 01        		bne	PRTWRD2
002639  1  E8           		inx
00263A  1  B9 94 26     PRTWRD2:	lda	PACKDEC,Y
00263D  1  29 0F        		and	#15
00263F  1  20 4C 26     		jsr	PRTNIB
002642  1  C8           		iny
002643  1  C0 03        		cpy	#3
002645  1  D0 E4        		bne	PRTWRD1
002647  1  A2 00        		ldx	#0
002649  1  4C FA 25     		jmp	NEWLINE
00264C  1               
00264C  1  D0 05        PRTNIB:		bne	PRTNIB1
00264E  1  E0 00        		cpx	#0
002650  1  D0 01        		bne	PRTNIB1
002652  1  60           		rts
002653  1               
002653  1  E8           PRTNIB1:	inx
002654  1  18           		clc
002655  1  69 30        		adc	#'0'
002657  1  4C FC 25     		jmp	PRINT
00265A  1               
00265A  1               
00265A  1  8E 93 26     WORD2D:		stx	WORD+1
00265D  1  8D 92 26     		sta	WORD
002660  1               
002660  1  A2 02        		ldx	#2
002662  1  A9 00        		lda	#0
002664  1  9D 94 26     WORD2D1:	sta	PACKDEC,X
002667  1  CA           		dex
002668  1  10 FA        		bpl	WORD2D1
00266A  1               
00266A  1  F8           		sed
00266B  1  A2 10        		ldx	#16
00266D  1               
00266D  1  0E 92 26     WORD2D3:	asl	WORD
002670  1  2E 93 26     		rol	WORD+1
002673  1               
002673  1  A0 02        		ldy	#2
002675  1  B9 94 26     WORD2D2:	lda	PACKDEC,Y
002678  1  79 94 26     		adc	PACKDEC,Y
00267B  1  99 94 26     		sta	PACKDEC,Y
00267E  1  88           		dey
00267F  1  10 F4        		bpl	WORD2D2
002681  1               
002681  1  CA           		dex
002682  1  D0 E9        		bne	WORD2D3
002684  1               
002684  1  D8           		cld
002685  1  60           		rts
002686  1               ;
002686  1               ; VAR + CONST
002686  1               ;
002686  1               
002686  1               PERCOM:
002686  1  00           PERTRK:		.byte	0
002687  1  00           PERSTP:		.byte	0
002688  1  00 00        PERSEC:		.word	0
00268A  1  00           PERHEA:		.byte	0
00268B  1  00           PERDEN:		.byte	0
00268C  1  00 00        PERBYT:		.word	0
00268E  1  00           PERSTA:		.byte	0
00268F  1  00           PERRAT:		.byte	0
002690  1  00           PERX01:		.byte	0
002691  1  00           PERX02:		.byte	0
002692  1               
002692  1  00 00        WORD:		.word	0
002694  1  00 00 00     PACKDEC:	.byte	0,0,0
002697  1               
002697  1  7D           SALLYMSG:	.byte	CLS
002698  1  2A 2A 2A 2A  		.byte	"******************", EOL
00269C  1  2A 2A 2A 2A  
0026A0  1  2A 2A 2A 2A  
0026AB  1  2A 20 53 61  		.byte	"* Sally 2 tools  *", EOL
0026AF  1  6C 6C 79 20  
0026B3  1  32 20 74 6F  
0026BE  1  2A 2A 2A 2A  		.byte	"******************", EOL
0026C2  1  2A 2A 2A 2A  
0026C6  1  2A 2A 2A 2A  
0026D1  1  9B           		.byte	EOL
0026D2  1  44 20 2D 20  		.byte	"D - Dump memory", EOL
0026D6  1  44 75 6D 70  
0026DA  1  20 6D 65 6D  
0026E2  1  47 20 2D 20  		.byte	"G - Goto address", EOL
0026E6  1  47 6F 74 6F  
0026EA  1  20 61 64 64  
0026F3  1  46 20 2D 20  		.byte	"F - Format", EOL
0026F7  1  46 6F 72 6D  
0026FB  1  61 74 9B     
0026FE  1  50 20 2D 20  		.byte	"P - Percom Block Config", EOL
002702  1  50 65 72 63  
002706  1  6F 6D 20 42  
002716  1  53 20 2D 20  		.byte	"S - Get Status", EOL
00271A  1  47 65 74 20  
00271E  1  53 74 61 74  
002725  1  54 20 2D 20  		.byte	"T - Test sector 1", EOL
002729  1  54 65 73 74  
00272D  1  20 73 65 63  
002737  1  55 20 2D 20  		.byte	"U - upload sally2.com", EOL
00273B  1  75 70 6C 6F  
00273F  1  61 64 20 73  
00274D  1  56 20 2D 20  		.byte	"V - Show Sally 2 version", EOL
002751  1  53 68 6F 77  
002755  1  20 53 61 6C  
002766  1  58 20 2D 20  		.byte	"X - EXIT", EOL
00276A  1  45 58 49 54  
00276E  1  9B           
00276F  1  00           		.byte	0
002770  1               
002770  1  9B           PERTXT0:	.byte	EOL
002771  1  44 69 73 70  		.byte	"Display PERCOM for"
002775  1  6C 61 79 20  
002779  1  50 45 52 43  
002783  1  20 55 6E 69  		.byte	" Unit (1-8 / x)?"
002787  1  74 20 28 31  
00278B  1  2D 38 20 2F  
002793  1  00           		.byte	0
002794  1               
002794  1  9B           PERTXT1:	.byte	EOL
002795  1  2A 2A 2A 2A  		.byte	"****************"
002799  1  2A 2A 2A 2A  
00279D  1  2A 2A 2A 2A  
0027A5  1  9B           		.byte	EOL
0027A6  1  2A 20 50 45  		.byte	"* PERCOM BLOCK *"
0027AA  1  52 43 4F 4D  
0027AE  1  20 42 4C 4F  
0027B6  1  9B           		.byte	EOL
0027B7  1  2A 2A 2A 2A  		.byte	"****************"
0027BB  1  2A 2A 2A 2A  
0027BF  1  2A 2A 2A 2A  
0027C7  1  9B           		.byte	EOL
0027C8  1  55 6E 69 74  MSGDUNIT:	.byte	"Unit       : "
0027CC  1  20 20 20 20  
0027D0  1  20 20 20 3A  
0027D5  1  00           		.byte	0
0027D6  1               
0027D6  1  54 72 61 63  MSGTRK:		.byte	"Tracks     : "
0027DA  1  6B 73 20 20  
0027DE  1  20 20 20 3A  
0027E3  1  00           		.byte	0
0027E4  1  53 74 65 70  		.byte	"Step       : "
0027E8  1  20 20 20 20  
0027EC  1  20 20 20 3A  
0027F1  1  00           		.byte	0
0027F2  1  53 65 63 2F  MSGSEC:		.byte	"Sec/Trk    : "
0027F6  1  54 72 6B 20  
0027FA  1  20 20 20 3A  
0027FF  1  00           		.byte	0
002800  1  48 65 61 64  MSGHEA:		.byte	"Heads (0-1): "
002804  1  73 20 28 30  
002808  1  2D 31 29 3A  
00280D  1  00           		.byte	0
00280E  1  44 65 6E 73  MSGDEN:		.byte	"Density    : "
002812  1  69 74 79 20  
002816  1  20 20 20 3A  
00281B  1  00           		.byte	0
00281C  1  42 79 74 2F  MSGBYT:		.byte	"Byt/Sec    : "
002820  1  53 65 63 20  
002824  1  20 20 20 3A  
002829  1  00           		.byte	0
00282A  1  53 65 6C 65  		.byte	"Select     : "
00282E  1  63 74 20 20  
002832  1  20 20 20 3A  
002837  1  00           		.byte	0
002838  1  53 65 72 52  		.byte	"SerRate    : "
00283C  1  61 74 65 20  
002840  1  20 20 20 3A  
002845  1  00           		.byte	0
002846  1  D4 72 61 63  		.byte	'T'+128, "racks ", 'S'+128, "ecs ", 'H'+128, "eads ", 'D'+128, "ensity ", 'B'+128, "ytes", EOL
00284A  1  6B 73 20 D3  
00284E  1  65 63 73 20  
002866  1  D7 72 69 74  		.byte	'W'+128, "rite  ", 'E', 'x'+128, "it", EOL
00286A  1  65 20 20 45  
00286E  1  F8 69 74 9B  
002872  1  00           		.byte	0
002873  1               
002873  1  44 3A 53 41  sallycom:	.byte	"D:SALLY2.COM",EOL
002877  1  4C 4C 59 32  
00287B  1  2E 43 4F 4D  
002880  1  61 64 64 72  msgadr:		.byte	"address:",0
002884  1  65 73 73 3A  
002888  1  00           
002889  1  00 00        ATADR:		.word	0
00288B  1  00 00        SALLYADR:	.word	0
00288D  1  00 00        SALLYLEN:	.word	0
00288F  1  00 00        DUMPADR:	.word	0
002891  1  00           CNT:		.byte	0
002892  1  00           BUFFER:		.byte	0
002892  1               
